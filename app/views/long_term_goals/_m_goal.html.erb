<% mid_term_goals = goal.mid_term_goals.rank(:row_order) %>
<% mid_term_goals.each do |m_goal| %>
  <%= content_tag "div", class: "item", data: { model_name: m_goal.class.name.underscore, update_url: mid_term_goal_sort_path(m_goal) } do %>
    <div>
      <%= m_goal.content %><%= m_goal.status %>
      <a data-remote="true" href="<%= mid_term_goal_short_term_goals_path(m_goal) %>">
        短期目標一覧<b class="caret"></b>
      </a><br />
      <span>期限</span>
      <%= link_to mid_term_goal_comments_path(m_goal) do %>
        <span>コメント <%= m_goal.comments.count %></span>
      <% end %><br />
      <%= render partial: 'likes/m_like', locals: { m_goal: m_goal } %><br />
    <%#= この中期目標が既にメモを持っている場合 %>
    <% if m_goal.memo %>
      <%= link_to 'メモ', memo_path(m_goal.memo), remote: true %><br />
    <% end %>
    <%#= 自分のページにいる場合 %>
    <% if current_user == @user %>
      <%#= この中期目標がメモを持っていない場合 %>
      <% unless m_goal.memo %>
        <%= link_to '新規メモ', mid_term_goal_memo_new_path(m_goal), remote: true %>
      <% end %>
      <%= link_to '編集', edit_mid_term_goal_path(m_goal), remote: true %>
      <%= link_to '削除', mid_term_goal_path(m_goal), method: :delete, remote: true,
        data: { confirm: "本当に削除しますか？" } %>
    <% end %>
    </div>
  <% end %>
<% end %>