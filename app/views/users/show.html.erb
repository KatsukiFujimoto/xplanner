<h1>Message</h1>
<div class = "row">
  <aside class="col-md-4">
    <h3 class = "message_side_top">メッセージルーム一覧</h3>
    <% if @users.any? %>
      <ul class="users messages_to">
        <% @users.each do |user| %>
          <li id = "user">
            <%= gravatar_for user, size: 50 %>
            <%= link_to user.name, "/messages/#{user.id}", data: {"turbolinks" => false} %>
          </li>
        <% end %>
      </ul>
      <%= will_paginate %>
    <% end %>
  </aside>
  
  <div class="messages col-md-8">
    <% if !current_user?(@user) && logged_in? %>
      <section class="message_box">
        <div id="messages">
          <%= render @messages %>
        </div>
      </section>
      <script type="text/javascript">
        var height = 0;
        $("div.message").each( function() {
          height += ($(this).height());
        });
        $('section.message_box').scrollTop(height);
      </script>
      <div class="message_form">
       <%= render 'messages/message_form',
         {from_user: current_user, to_user: @user, room_id: @room_id} %>
      </div>
    <% end %>
  </div>
</div>